<html>

<head>
    <title>AUCTCHAIN</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <!-- <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script> -->
    <script src="js/bootstrap.min.js"></script>
    <style>
        ::-webkit-scrollbar {
            width: 0 !important;
        }
    </style>
</head>

<body>
    <nav class="navbar sticky-top navbar-dark bg-dark">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="h3" style="color:white">
                    Hello, <small id="out_show_user">Anonymous</small>
                </a>
            </li>
            <li class="nav-item">
                <a class="h5" style="color:white">
                    You have, <small id="out_show_balance">unknown</small> ETH balance.
                </a>
            </li>
            <li class="nav-item">
                <a class="h5" id="checking" style="color:white">
                </a>
            </li>
        </ul>

    </nav>
    <div class="container-fluid pull-left ">
        <div class="row pull-left">
            <div class="col pull-left">
                <form id="form_regist" style="display: inherit; margin-top: 25px; border-radius: 5px;">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" class="form-control" id="in_reg_name" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label>Email address</label>
                        <input type="email" class="form-control" id="in_reg_email" aria-describedby="emailHelp"
                            placeholder="Enter your email">
                        <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                            else.</small>
                    </div>
                    <div class="form-group">
                        <label>Contact</label>
                        <input type="text" class="form-control" id="in_reg_contact" placeholder="Enter your contact">
                    </div>
                    <button type="submit" id="btn_regist" class="btn btn-primary">Submit</button>
                </form>
            </div>
            <div class="col pull-left">
                <form id="form_regist" style="display: inherit; margin-top: 25px; border-radius: 5px;">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" class="form-control" id="in_reg_item_title">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" class="form-control" id="in_reg_item_desc">
                    </div>
                    <div class="form-group">
                        <label>Link</label>
                        <input type="text" class="form-control" id="in_reg_item_link">
                    </div>
                    <div class="form-group">
                        <label>Deadline</label>
                        <input type="text" class="form-control" id="in_reg_item_deadline">
                    </div>
                    <div class="form-group">
                        <label>Start Price</label>
                        <input type="text" class="form-control" id="in_reg_item_startprc">
                    </div>
                    <button id="btn_item_regist" class="btn btn-primary">Submit</button>
                </form>
            </div>
            <div class="col pull-left">
                <form id="form_regist" style="display: inherit; margin-top: 25px; border-radius: 5px;">
                    <div class="form-group">
                        <label class="sr-only" for="inlineFormInputGroup">Bid</label>
                        <div class="input-group mb-2">
                            <input id="in_bid_val_wei" type="text" class="form-control" onclick="convertWei();">
                            <div class="input-group-prepend">
                                <div class="input-group-text">WEI</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group mb-2">
                            <h4 id="in_bid_val_eth"></h4>
                            <div class="input-group-prepend">
                                <div class="input-group-text">ETH</div>
                            </div>
                        </div>
                    </div>
                    <button type="submit" id="btn_bid" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>

    <div class="container">
        <table class="table table-hover table-nd">
            <caption>Bid List</caption>
            <thead class="thead-dark">
                <tr>
                    <th>seller</th>
                    <th>title</th>
                    <th>description</th>
                    <th>link</th>
                    <th>description</th>
                    <th>blockNumberOfDeadline</th>
                    <th>startingPrice</th>
                    <th>bids</th>
                </tr>
            </thead>
            <tbody id="table_historyBid">
                <!-- History Goes Here -->
            </tbody>
        </table>
    </div>
    <script src="js/web3.min.js"></script>
    <script src="js/requirement.js"></script>
    <script>
        // Refresh hack
        // window.onreset = () => {
        //     window.location.reload();
        // }
        // Membuat variable global untuk menampung account address
        let accountAddress = null;

        window.addEventListener('load', () => {
            // Load Web3 Support
            web3 = new Web3(window.web3.currentProvider);
            if (typeof window.web3 !== 'undefined' && typeof window.web3.currentProvider !== 'undefined')
                web3.eth.setProvider(window.web3.currentProvider);
            else
                web3.eth.setProvider(provider); // set to TestRPC if not available

            AuctionHouse = getContract();
            queryUser = document.querySelector('#out_show_user');
            queryBalance = document.querySelector('#out_show_balance');
            web3.eth.getAccounts().then(accounts => {
                accountAddress = accounts[0];
                web3.eth.getBalance(accounts[0]).then(res => {
                    queryBalance.innerHTML = web3.utils.fromWei(res, 'ether');
                });
            });

            var auctionInterval = setInterval(function updateAuctionHTML() {

                queryStatus = document.querySelector('#out_reg_status');
                AuctionHouse.methods.isRegistered(accountAddress).call().then(res => {
                    if (res) {
                        AuctionHouse.methods.getRegisteredData(accountAddress).call().then(reg => {
                            queryUser.innerHTML = reg[0] + ' // ' + reg[1] + ' // ' +
                                reg[2];
                        });
                        document.querySelector('#form_regist').style.display = 'none';
                    } else {
                        queryUser.innerHTML = accountAddress;
                        document.querySelector('#form_regist').style.display = 'inherit';
                    }
                });
            }, 100);


            AuctionHouse.methods.getAuctionCount().call().then(length => {
                for (var i = 0; i < length; i++) {
                    allert(length);
                    AuctionHouse.methods.getAuction().call(auctionId).then(function (result) {
                        var container = document.getElementById("#table_historyBid");
                        container.innerHTML = constructAuctionView(result[0]);
                    });
                }
            });

            const registEvent = document.querySelector('#btn_regist');
            registEvent.addEventListener('click', () => {
                const userName = document.querySelector("#in_reg_name").value;
                const userEmail = document.querySelector("#in_reg_email").value;
                const userContact = document.querySelector("#in_reg_contact").value;

                AuctionHouse.methods.register(userName, userEmail, userContact).send({
                    from: accountAddress
                });
            });

            const registItemEvent = document.querySelector('#btn_item_regist');
            registItemEvent.addEventListener('click', () => {
                const itemTitle = document.querySelector("#in_reg_item_title").value;
                const itemDesc = document.querySelector("#in_reg_item_desc").value;
                const itemLink = document.querySelector("#in_reg_item_link").value;
                const itemDeadline = document.querySelector("#in_reg_item_deadline").value;
                const itemStrPrice = document.querySelector("#in_reg_item_startprc").value;

                AuctionHouse.methods.createAuction(itemTitle, itemDesc, itemLink, itemDeadline,
                    itemStrPrice).send({
                    from: accountAddress
                });
            });

            // const registEvent = document.querySelector('#btn_regist');
            // registEvent.addEventListener('click', () => {
            //     const name = document.querySelector("#in_reg_name").value;
            //     const email = document.querySelector("#in_reg_email").value;
            //     const contact = document.querySelector("#in_reg_contact").value;

            //     AuctionHouse.methods.register(name, email, contact).send({
            //         from: accountAddress
            //     });
            // });

            // // seleksi input dan button
            // const bidVal = document.querySelector('#bid-value');
            // const bidBtn = document.querySelector('#bid-btn');

            // // menambahkan listener click pada button donate
            // bidBtn.addEventListener('click', () => {
            //     // mengambil value jumlah ether yang akan didonasikan dalam string
            //     const nama = document.querySelector("#nama-bidder").value;
            //     const email = document.querySelector("#email-bidder").value;
            //     const telepon = document.querySelector("#telepon-bidder").value;
            //     const bidValue = bidVal.value;

            //     Auction.methods.bid().send({
            //         value: web3.utils.toWei(bidValue, 'ether'),
            //         from: accountAddress
            //     });
            // });
            /* Event Regist */
            // const registEvent = document.querySelector('#bid-btn');

        });
    </script>

</body>

</html>